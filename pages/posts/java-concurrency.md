---
title: Java å¹¶å‘ç¼–ç¨‹åŸºç¡€
categories: Java
tags:
  - åç«¯
  - Java
  - å¤šçº¿ç¨‹
---


## è¿›ç¨‹ä¸çº¿ç¨‹




### è¿›ç¨‹
- ç¨‹åºç”±æŒ‡ä»¤å’Œæ•°æ®ç»„æˆï¼Œä½†è¿™äº›æŒ‡ä»¤è¦è¿è¡Œï¼Œæ•°æ®è¦è¯»å†™ï¼Œå°±å¿…é¡»å°†æŒ‡ä»¤åŠ è½½è‡³ CPUï¼Œæ•°æ®åŠ è½½è‡³å†…å­˜ã€‚åœ¨æŒ‡ä»¤è¿è¡Œè¿‡ç¨‹ä¸­è¿˜éœ€è¦ç”¨åˆ°ç£ç›˜ ã€ç½‘ç»œç­‰è®¾å¤‡ã€‚**è¿›ç¨‹å°±æ˜¯ç”¨æ¥åŠ è½½æŒ‡ä»¤ã€ç®¡ç†å†…å­˜ã€ç®¡ç† IO çš„** 
- å½“ä¸€ä¸ªç¨‹åºè¢«è¿è¡Œï¼Œä»ç£ç›˜åŠ è½½è¿™ä¸ªç¨‹åºçš„ä»£ç è‡³å†…å­˜ï¼Œè¿™æ—¶å°±å¼€å¯äº†ä¸€ä¸ªè¿›ç¨‹ã€‚ 
- è¿›ç¨‹å°±å¯ä»¥è§†ä¸ºç¨‹åºçš„ä¸€ä¸ªå®ä¾‹ã€‚å¤§éƒ¨åˆ†ç¨‹åºå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªå®ä¾‹è¿›ç¨‹ï¼ˆä¾‹å¦‚è®°äº‹æœ¬ã€ç”»å›¾ã€æµè§ˆå™¨ç­‰ï¼‰ï¼Œä¹Ÿæœ‰çš„ç¨‹åºåªèƒ½å¯åŠ¨ä¸€ä¸ªå®ä¾‹è¿›ç¨‹ï¼ˆä¾‹å¦‚ç½‘æ˜“äº‘éŸ³ä¹ã€360 å®‰å…¨å«å£«ç­‰ï¼‰ 
>è¿›ç¨‹å¯ä»¥ç†è§£ä¸ºç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯åŠ¨æ€çš„ï¼


### çº¿ç¨‹

- ä¸€ä¸ªè¿›ç¨‹ä¹‹å†…å¯ä»¥åˆ†ä¸ºä¸€åˆ°å¤šä¸ªçº¿ç¨‹ã€‚ 
- ä¸€ä¸ªçº¿ç¨‹å°±æ˜¯ä¸€ä¸ªæŒ‡ä»¤æµï¼Œå°†æŒ‡ä»¤æµä¸­çš„ä¸€æ¡æ¡æŒ‡ä»¤ä»¥ä¸€å®šçš„é¡ºåºäº¤ç»™ CPU æ‰§è¡Œ 
- Java ä¸­ï¼Œçº¿ç¨‹æ˜¯æœ€å°çš„è°ƒåº¦å•ä½ï¼Œè¿›ç¨‹ä½œä¸ºèµ„æºåˆ†é…çš„æœ€å°å•ä½ã€‚ åœ¨ Windows ä¸­è¿›ç¨‹æ˜¯ä¸æ´»åŠ¨çš„ï¼Œåªæ˜¯ä½œä¸ºçº¿ç¨‹çš„å®¹å™¨


### å¯¹æ¯”
- è¿›ç¨‹åŸºæœ¬ä¸Šç›¸äº’ç‹¬ç«‹ï¼Œè€Œçº¿ç¨‹å­˜åœ¨äºè¿›ç¨‹å†…ï¼Œæ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå­é›†
- è¿›ç¨‹æ‹¥æœ‰å…±äº«çš„èµ„æºï¼Œå¦‚å†…å­˜ç©ºé—´ç­‰ï¼Œä¾›å…¶å†…éƒ¨çš„çº¿ç¨‹å…±äº«
- è¿›ç¨‹é—´é€šä¿¡è¾ƒä¸ºå¤æ‚
  - åŒä¸€å°è®¡ç®—æœºçš„è¿›ç¨‹é€šä¿¡ç§°ä¸º IPC (Inter-process communication)
  - ä¸åŒè®¡ç®—æœºä¹‹é—´çš„è¿›ç¨‹é€šä¿¡ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œï¼Œå¹¶éµå®ˆå…±åŒçš„åè®®ï¼Œä¾‹å¦‚ HTTP åè®®
- çº¿ç¨‹é€šä¿¡ç›¸å¯¹ç®€å•ï¼Œå› ä¸ºå®ƒä»¬å…±äº«è¿›ç¨‹å†…çš„å†…å­˜ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®åŒä¸€ä¸ªå…±äº«å˜é‡
- çº¿ç¨‹æ›´è½»é‡ï¼Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ä¸€èˆ¬è¦æ¯”è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä½

### ğŸ’¡é¢è¯•é¢˜
ä»€ä¹ˆæ˜¯è¿›ç¨‹å’Œçº¿ç¨‹ï¼Ÿ

è¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿè¿è¡Œç¨‹åºçš„åŸºæœ¬å•ä½ï¼Œå› æ­¤è¿›ç¨‹æ˜¯åŠ¨æ€çš„ã€‚ç³»ç»Ÿè¿è¡Œä¸€ä¸ªç¨‹åºå³æ˜¯ä¸€ä¸ªè¿›ç¨‹ä»åˆ›å»ºï¼Œè¿è¡Œåˆ°æ¶ˆäº¡çš„è¿‡ç¨‹ã€‚

åœ¨ Java ä¸­ï¼Œå½“æˆ‘ä»¬å¯åŠ¨ main å‡½æ•°æ—¶å…¶å®å°±æ˜¯å¯åŠ¨äº†ä¸€ä¸ª JVM çš„è¿›ç¨‹ï¼Œè€Œ main å‡½æ•°æ‰€åœ¨çš„çº¿ç¨‹å°±æ˜¯è¿™ä¸ªè¿›ç¨‹ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿç§°ä¸»çº¿ç¨‹ã€‚

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨ Windows ä¸­é€šè¿‡æŸ¥çœ‹ä»»åŠ¡ç®¡ç†å™¨çš„æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¸…æ¥šçœ‹åˆ° Windows å½“å‰è¿è¡Œçš„è¿›ç¨‹ï¼ˆ.exe æ–‡ä»¶çš„è¿è¡Œï¼‰ã€‚
![](https://zzyang.oss-cn-hangzhou.aliyuncs.com/img/xw_20250811211830.png)

*ä½•ä¸ºçº¿ç¨‹?*

çº¿ç¨‹ä¸è¿›ç¨‹ç›¸ä¼¼ï¼Œä½†çº¿ç¨‹æ˜¯ä¸€ä¸ªæ¯”è¿›ç¨‹æ›´å°çš„æ‰§è¡Œå•ä½ã€‚ä¸€ä¸ªè¿›ç¨‹åœ¨å…¶æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¯ä»¥äº§ç”Ÿå¤šä¸ªçº¿ç¨‹ã€‚ä¸è¿›ç¨‹ä¸åŒçš„æ˜¯åŒç±»çš„å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„**å †**å’Œ**æ–¹æ³•åŒº**èµ„æºï¼Œä½†æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„**ç¨‹åºè®¡æ•°å™¨**ã€**è™šæ‹Ÿæœºæ ˆ**å’Œ**æœ¬åœ°æ–¹æ³•æ ˆ**ï¼Œæ‰€ä»¥ç³»ç»Ÿåœ¨äº§ç”Ÿä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ–æ˜¯åœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´åšåˆ‡æ¢å·¥ä½œæ—¶ï¼Œè´Ÿæ‹…è¦æ¯”è¿›ç¨‹å°å¾—å¤šï¼Œä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œçº¿ç¨‹ä¹Ÿè¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹ã€‚

## å¹¶è¡Œä¸å¹¶å‘

å¹¶å‘æ˜¯åœ¨åŒä¸€æ—¶é—´æ®µï¼Œå¹¶è¡Œæ˜¯åœ¨åŒä¸€æ—¶åˆ»ï¼

:::tip
å¹¶å‘ï¼ˆConcurrentï¼‰ï¼šä¸€ä¸ªäººåŒæ—¶åšå¾ˆå¤šä¸åŒäº‹æƒ… 

å¹¶è¡Œï¼ˆParallelï¼‰ï¼šä¸€ç¾¤äººå„è‡ªåŒæ—¶åšå¾ˆå¤šäº‹æƒ…
:::

### å¹¶å‘
å•æ ¸ CPU ä¸‹ï¼Œçº¿ç¨‹å®é™…è¿˜æ˜¯ `ä¸²è¡Œæ‰§è¡Œ` çš„ã€‚æ“ä½œç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªç»„ä»¶å«åš*ä»»åŠ¡è°ƒåº¦å™¨*ï¼Œå°† CPU çš„æ—¶é—´ç‰‡ï¼ˆwindows ä¸‹æ—¶é—´ç‰‡æœ€å°çº¦ä¸º 15 æ¯«ç§’ï¼‰åˆ†ç»™ä¸åŒçš„ç¨‹åºä½¿ç”¨ï¼Œåªæ˜¯ç”±äº CPU åœ¨çº¿ç¨‹é—´ï¼ˆæ—¶é—´ç‰‡å¾ˆçŸ­ï¼‰çš„åˆ‡æ¢éå¸¸å¿«ï¼Œäººç±»æ„Ÿè§‰æ˜¯åŒæ—¶è¿è¡Œçš„ ã€‚æ€»ç»“ä¸ºä¸€å¥è¯å°±æ˜¯ï¼š *å¾®è§‚ä¸²è¡Œï¼Œå®è§‚å¹¶è¡Œ* ã€‚

>ä¸€èˆ¬æˆ‘ä»¬ä¼šå°†è¿™ç§ *çº¿ç¨‹è½®æµä½¿ç”¨CPU* çš„åšæ³•ç§°ä¸º:  **å¹¶å‘ï¼ˆ Concurrentï¼‰**

| CPU  | æ—¶é—´ç‰‡ 1 | æ—¶é—´ç‰‡ 2 | æ—¶é—´ç‰‡ 3 | æ—¶é—´ç‰‡ 4 |
|------|----------|----------|----------|----------|
| core | çº¿ç¨‹ 1   | çº¿ç¨‹ 2   | çº¿ç¨‹ 3   | çº¿ç¨‹ 4   |

![](https://zzyang.oss-cn-hangzhou.aliyuncs.com/img/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B_page7_image.png)
### å¹¶è¡Œ
å¤šæ ¸ cpuä¸‹ï¼Œæ¯ä¸ª `æ ¸ï¼ˆcoreï¼‰` éƒ½å¯ä»¥è°ƒåº¦è¿è¡Œçº¿ç¨‹ï¼Œè¿™æ—¶å€™çº¿ç¨‹å¯ä»¥æ˜¯ **å¹¶è¡Œ** çš„
| CPU | æ—¶é—´ç‰‡ 1 | æ—¶é—´ç‰‡ 2 | æ—¶é—´ç‰‡ 3 | æ—¶é—´ç‰‡ 4 |
| --- | --- | --- | --- | --- |
| core 1 | çº¿ç¨‹ 1 | çº¿ç¨‹ 1 | çº¿ç¨‹ 3 | çº¿ç¨‹ 3 |
| core 2 | çº¿ç¨‹ 2 | çº¿ç¨‹ 4 | çº¿ç¨‹ 2 | çº¿ç¨‹ 4 |

![](https://zzyang.oss-cn-hangzhou.aliyuncs.com/img/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B_page8_image.png)

>åœ¨å¤šæ ¸ CPU ä¸‹å¹¶å‘å’Œå¹¶è¡Œæ˜¯åŒæ—¶å­˜åœ¨çš„ã€‚

:::info
- å¹¶å‘ï¼ˆconcurrentï¼‰æ˜¯åŒä¸€æ—¶é—´åº”å¯¹ï¼ˆdealing withï¼‰å¤šä»¶äº‹æƒ…çš„èƒ½åŠ›
- å¹¶è¡Œï¼ˆparallelï¼‰æ˜¯åŒä¸€æ—¶é—´åŠ¨æ‰‹åšï¼ˆdoingï¼‰å¤šä»¶äº‹æƒ…çš„èƒ½åŠ›
:::


ç”Ÿæ´»ä¾‹å­
- å®¶åº­ä¸»å¦‡åšé¥­ã€æ‰“æ‰«å«ç”Ÿã€ç»™å­©å­å–‚å¥¶ï¼Œå¥¹ä¸€ä¸ªäººè½®æµäº¤æ›¿åšè¿™å¤šä»¶äº‹ï¼Œè¿™æ—¶å°±æ˜¯å¹¶å‘
- å®¶åº­ä¸»å¦‡é›‡äº†ä¸ªä¿å§†ï¼Œå¥¹ä»¬ä¸€èµ·è¿™äº›äº‹ï¼Œè¿™æ—¶æ—¢æœ‰å¹¶å‘ï¼Œä¹Ÿæœ‰å¹¶è¡Œï¼ˆè¿™æ—¶ä¼šäº§ç”Ÿç«äº‰ï¼Œä¾‹å¦‚é”…åªæœ‰ä¸€å£ï¼Œä¸€ä¸ªäººç”¨é”…æ—¶ï¼Œå¦ä¸€ä¸ªäººå°±å¾—ç­‰å¾…ï¼‰
- é›‡äº†3ä¸ªä¿å§†ï¼Œä¸€ä¸ªä¸“åšé¥­ã€ä¸€ä¸ªä¸“æ‰“æ‰«å«ç”Ÿã€ä¸€ä¸ªä¸“å–‚å¥¶ï¼Œäº’ä¸å¹²æ‰°ï¼Œè¿™æ—¶æ˜¯å¹¶è¡Œ


### ğŸ’¡é¢è¯•é¢˜

å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«
- å¹¶å‘ï¼šä¸¤ä¸ªåŠä¸¤ä¸ªä»¥ä¸Šçš„ä½œä¸šåœ¨åŒä¸€ æ—¶é—´æ®µ å†…æ‰§è¡Œ
- å¹¶è¡Œï¼šä¸¤ä¸ªåŠä¸¤ä¸ªä»¥ä¸Šçš„ä½œä¸šåœ¨åŒä¸€ æ—¶åˆ» æ‰§è¡Œ
æœ€å…³é”®çš„ç‚¹æ˜¯ï¼šæ˜¯å¦æ˜¯ åŒæ—¶ æ‰§è¡Œ

åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«
- åŒæ­¥ï¼šå‘å‡ºä¸€ä¸ªè°ƒç”¨ä¹‹åï¼Œåœ¨æ²¡æœ‰å¾—åˆ°ç»“æœä¹‹å‰ï¼Œ è¯¥è°ƒç”¨å°±ä¸å¯ä»¥è¿”å›ï¼Œä¸€ç›´ç­‰å¾…ã€‚
- å¼‚æ­¥ï¼šè°ƒç”¨åœ¨å‘å‡ºä¹‹åï¼Œä¸ç”¨ç­‰å¾…è¿”å›ç»“æœï¼Œè¯¥è°ƒç”¨ç›´æ¥è¿”å›ã€‚


## çº¿ç¨‹åŸºæœ¬åº”ç”¨

### å¼‚æ­¥è°ƒç”¨

ä»æ–¹æ³•è°ƒç”¨æ–¹çš„è§’åº¦æ¥è®²ï¼Œå¦‚æœï¼š
- éœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œæ‰èƒ½ç»§ç»­è¿è¡Œå°±æ˜¯ **åŒæ­¥**
- ä¸éœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œå°±èƒ½ç»§ç»­è¿è¡Œå°±æ˜¯ **å¼‚æ­¥**

æ³¨ï¼šåŒæ­¥åœ¨å¤šçº¿ç¨‹ä¸­è¿˜æœ‰å¦å¤–ä¸€ä¸ªæ„æ€ï¼Œå°±æ˜¯è®©å¤šä¸ªçº¿ç¨‹æ­¥è°ƒä¸€è‡´


1ï¼‰è®¾è®¡
å¤šçº¿ç¨‹å¯ä»¥è®©æ–¹æ³•æ‰§è¡Œå˜æˆå¼‚æ­¥çš„ï¼ˆå³ä¸è¦ä¸€ç›´å¹²ç­‰ç€ï¼‰ã€‚æ¯”å¦‚è¯»å–ç£ç›˜æ–‡ä»¶æ—¶ï¼Œå‡è®¾è¯»å–æ“ä½œéœ€è¦èŠ±è´¹ 5sï¼Œå¦‚æœæ²¡æœ‰çº¿ç¨‹è°ƒåº¦æœºåˆ¶ï¼Œé‚£ä¹ˆè¿™ 5s è°ƒç”¨è€…å…¶ä»–çš„äº‹éƒ½åšä¸äº†ï¼Œå…¶ä½™ä»£ç éƒ½å¾—æš‚åœã€‚

2ï¼‰ç»“è®º
- åœ¨é¡¹ç›®ä¸­ï¼Œå¦‚æœéœ€è¦è¿›è¡Œä¸€äº›è´¹æ—¶æ“ä½œï¼Œæ¯”å¦‚è§†é¢‘æ–‡ä»¶éœ€è¦è½¬æ¢æ ¼å¼ç­‰æ“ä½œï¼Œè¿™æ—¶å¼€ä¸€ä¸ªæ–°çº¿ç¨‹å¤„ç†è§†é¢‘è½¬æ¢ï¼Œé¿å…é˜»å¡ä½ä¸»çº¿ç¨‹
- Tomcat çš„å¼‚æ­¥ Servlet ä¹Ÿæ˜¯ç±»ä¼¼çš„ç›®çš„ï¼Œè®©ç”¨æˆ·çº¿ç¨‹å¤„ç†è€—æ—¶è¾ƒé•¿çš„æ“ä½œï¼Œé¿å…é˜»å¡ Tomcat çš„å·¥ä½œçº¿ç¨‹ 
- UI ç¨‹åºä¸­ï¼Œå¼€çº¿ç¨‹è¿›è¡Œå…¶ä»–æ“ä½œï¼Œé¿å…é˜»å¡ UI çº¿ç¨‹

åŒæ­¥ç­‰å¾…
```java
@Slf4j(topic = "c.Sync")
public class Sync {
    public static void main(String[] args) {
        FileReader.read(Constants.MP4_FULL_PATH);  // åŒæ­¥è°ƒç”¨
        log.debug("do other things ...");
    }
}
```
å¼‚æ­¥ä¸ç­‰å¾…
```java
@Slf4j(topic = "c.Async")
public class Async {
    public static void main(String[] args) {
        // å¼‚æ­¥è°ƒç”¨
        new Thread(new Runnable() {
            public void run() {
                FileReader.read(Constants.MP4_FULL_PATH);
            }
        }).start();

        log.debug("do other things ...");
    }
}
```

---
**æé«˜è¿è¡Œæ•ˆç‡**

å……åˆ†åˆ©ç”¨å¤šæ ¸ cpu çš„ä¼˜åŠ¿ï¼Œæé«˜è¿è¡Œæ•ˆç‡ã€‚æƒ³è±¡ä¸‹é¢çš„åœºæ™¯ï¼šæ‰§è¡Œ 3 ä¸ªè®¡ç®—ï¼Œæœ€åå°†è®¡ç®—ç»“æœæ±‡æ€»ã€‚

>è®¡ç®— 1 èŠ±è´¹ 10 ms
>
>è®¡ç®— 2 èŠ±è´¹ 11 ms
>
>è®¡ç®— 3 èŠ±è´¹ 9 ms
>
>æ±‡æ€»éœ€è¦ 1 ms

- å¦‚æœæ˜¯ä¸²è¡Œæ‰§è¡Œï¼Œé‚£ä¹ˆæ€»å…±èŠ±è´¹çš„æ—¶é—´æ˜¯ 10 + 11 + 9 + 1 = 31ms 
- ä½†å¦‚æœæ˜¯å››æ ¸ cpuï¼Œå„ä¸ªæ ¸å¿ƒåˆ†åˆ«ä½¿ç”¨çº¿ç¨‹ 1 æ‰§è¡Œè®¡ç®— 1ï¼Œçº¿ç¨‹ 2 æ‰§è¡Œè®¡ç®— 2ï¼Œçº¿ç¨‹ 3 æ‰§è¡Œè®¡ç®— 3ï¼Œé‚£ä¹ˆ 3 ä¸ª çº¿ç¨‹æ˜¯å¹¶è¡Œçš„ï¼ŒèŠ±è´¹æ—¶é—´åªå–å†³äºæœ€é•¿çš„é‚£ä¸ªçº¿ç¨‹è¿è¡Œçš„æ—¶é—´ï¼Œå³ 11msæœ€ååŠ ä¸Šæ±‡æ€»æ—¶é—´åªä¼šèŠ±è´¹ 12ms 
- éœ€è¦åœ¨å¤šæ ¸ cpu æ‰èƒ½æé«˜æ•ˆç‡ï¼Œå•æ ¸ä»ç„¶æ˜¯è½®æµæ‰§è¡Œã€‚


---

## åˆ›å»ºä¸è¿è¡Œçº¿ç¨‹

### ä½¿ç”¨Thread

>Java ç¨‹åºåœ¨å¯åŠ¨æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªä¸»æ–¹æ³•çº¿ç¨‹ï¼ˆä¹Ÿç§°ï¼šä¸»çº¿ç¨‹ï¼‰ã€‚é»˜è®¤å°±å·²ç»æœ‰ä¸€ä¸ªä¸»çº¿ç¨‹åœ¨è¿è¡Œã€‚
```java
// åˆ›å»ºçº¿ç¨‹å¯¹è±¡
Thread t = new Thread("t1") {
    @Override
    public void run() {
        // è¦æ‰§è¡Œçš„ä»»åŠ¡
    }
};
// å¯åŠ¨çº¿ç¨‹
t.start();
```

æŒ‡å®šåç§°
```java
@Slf4j(topic = "c.Test1")
public class DirectUseThreadTest {
    public static void main(String[] args) {
        // åˆ›å»ºçº¿ç¨‹
        Thread t1 = new Thread("t1") {  // æŒ‡å®šåç§°ï¼ˆæ–¹å¼ä¸€ï¼‰
            @Override
            public void run() {
                log.debug("running ...");
            }
        };

        t1.setName("t1");  // æŒ‡å®šåç§°ï¼ˆæ–¹å¼äºŒï¼‰

        // å¯åŠ¨çº¿ç¨‹
        t1.start();

        // ä¸»çº¿ç¨‹æ‰“å°
        log.debug("running ...");
    }
}
```

Lambdaå†™æ³•
```java
@Slf4j
public class ThreadDemo {
    public static void main(String[] args) {
        new Thread(() -> {
            log.info("running");
        }, "t1").start();

        log.info("main");
    }
}
```


### ä½¿ç”¨Runableé…åˆThread
æŠŠã€çº¿ç¨‹ã€‘å’Œã€ä»»åŠ¡ã€‘(è¦æ‰§è¡Œçš„ä»£ç ) åˆ†å¼€
- Thread ä»£è¡¨çº¿ç¨‹
- Runnable ä»£è¡¨å¯è¿è¡Œçš„ä»»åŠ¡ï¼ˆçº¿ç¨‹è¦æ‰§è¡Œçš„ä»£ç ï¼‰

è¯­æ³•ï¼š
```java
Runnable runnable = new Runnable() {
    @Override
    public void run() {
        // è¦æ‰§è¡Œçš„ä»»åŠ¡
    }
};
// åˆ›å»ºçº¿ç¨‹å¯¹è±¡
Thread t = new Thread(runnable);
// å¯åŠ¨çº¿ç¨‹
t.start();
```

```java
// åˆ›å»ºä»»åŠ¡å¯¹è±¡
Runnable task2 = new Runnable() {
    @Override
    public void run() {
        log.debug("hello");
    }
};

// å‚æ•°1 æ˜¯ä»»åŠ¡å¯¹è±¡; å‚æ•°2 æ˜¯çº¿ç¨‹åå­—
Thread t2 = new Thread(task2, "t2");
t2.start();
```

lambdaè¡¨è¾¾å¼:
```java
// åˆ›å»ºä»»åŠ¡å¯¹è±¡
Runnable task2 = () -> log.debug("hello");

// å‚æ•°1 æ˜¯ä»»åŠ¡å¯¹è±¡; å‚æ•°2 æ˜¯çº¿ç¨‹åå­—ï¼Œæ¨è
Thread t2 = new Thread(task2, "t2");
t2.start();



public static void test2() {
    Runnable runnable = () -> log.info("runnable running");
    new Thread(runnable, "t2").start();
}
```

åŸç† â€”â€” Thread ä¸ Runnable çš„å…³ç³»

Thread æ ¸å¿ƒæºç 
```java
private Runnable target;

@Override
public void run() {
    if (target != null) {
        target.run();
    }
}
```
å®é™…ï¼Œå°±æ˜¯åœ¨ Thread ä¸­çš„ run æ–¹æ³•é‡Œé¢è°ƒç”¨äº† Runnable æ–¹æ³•çš„ run æ–¹æ³•æ¥æ‰§è¡Œä»»åŠ¡ã€‚

- ç¬¬ä¸€ç§åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•æ˜¯æŠŠçº¿ç¨‹å’Œä»»åŠ¡çš„åˆ›å»ºåˆå¹¶åœ¨äº†ä¸€èµ·ï¼Œç¬¬äºŒç§åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•æ˜¯æŠŠçº¿ç¨‹å’Œä»»åŠ¡åˆ†å¼€åˆ›å»ºäº† 
- ç”¨ Runnable æ›´å®¹æ˜“ä¸çº¿ç¨‹æ± ç­‰é«˜çº§ API é…åˆ 
- ç”¨ Runnable è®©ä»»åŠ¡ç±»è„±ç¦»äº† Thread ç»§æ‰¿ä½“ç³»ï¼Œæ›´çµæ´»

### FutureTaské…åˆThread

FutureTaskèƒ½å¤Ÿæ¥æ”¶Callableç±»å‹çš„å‚æ•°ï¼Œç”¨æ¥**å¤„ç†æœ‰è¿”å›ç»“æœçš„æƒ…å†µ**ã€‚

```java
@Slf4j(topic = "c.Test3")
public class FutureAndCallableTest {
    public static void main(String[] args) throws ExecutionException, InterruptedException {
        // 1.åˆ›å»ºä»»åŠ¡å¯¹è±¡
        FutureTask<Integer> task = new FutureTask<>(new Callable<>() {
            @Override
            public Integer call() throws Exception {
                log.debug("running ...");
                Thread.sleep(4000);
                return 100;
            }
        });

        // 2.åˆ›å»ºçº¿ç¨‹å¯¹è±¡ï¼Œå¹¶å…³è”ä»»åŠ¡
        Thread t = new Thread(task, "t3");

        t.start();

        // ä¸»çº¿ç¨‹è¿è¡Œåˆ°æ­¤å¤„æ—¶ï¼Œå°±ä¼šä¸€ç›´é˜»å¡ã€‚ç›´åˆ° task æ‰§è¡Œå®Œæ¯•åè¿”å›ç»“æœ
        log.debug("{}",  task.get());
    }
}
```

```
11:46:34.082 c.Test3 [t3] - running ...
11:50:35.093 c.Test3 [main] - 100
```

lambda:
```java
    public static void main(String[] args) throws ExecutionException, InterruptedException {
        FutureTask<Integer> task = new FutureTask<>(() -> {
            TimeUnit.SECONDS.sleep(1);
            log.info("running...");
            return 100;
        });
        new Thread(task, "t1").start();
        Integer i = task.get();
        log.info("i:{}", i);
    }
```


## æŸ¥çœ‹è¿›ç¨‹çº¿ç¨‹çš„æ–¹æ³•

Windows
- ä»»åŠ¡ç®¡ç†å™¨å¯ä»¥æŸ¥çœ‹è¿›ç¨‹å’Œçº¿ç¨‹æ•°ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥æ€æ­»è¿›ç¨‹
- `tasklist` æŸ¥çœ‹è¿›ç¨‹
- `taskkill` æ€æ­»è¿›ç¨‹

linux
- `ps -ef` æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹
- `ps -fT -p <PID>` æŸ¥çœ‹æŸä¸ªè¿›ç¨‹ï¼ˆPIDï¼‰çš„æ‰€æœ‰çº¿ç¨‹
- `kill` æ€æ­»è¿›ç¨‹
- `top` æŒ‰å¤§å†™ H åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºçº¿ç¨‹
- `top -H -p <PID>` æŸ¥çœ‹æŸä¸ªè¿›ç¨‹ï¼ˆPIDï¼‰ä¸­çš„æ‰€æœ‰çº¿ç¨‹

Java
- `jps` å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰ Java è¿›ç¨‹
- `jstack <PID>` æŸ¥çœ‹æŸä¸ª Java è¿›ç¨‹ï¼ˆPIDï¼‰åœ¨è¿è¡Œ jstack æ—¶çš„æ‰€æœ‰çº¿ç¨‹çŠ¶æ€
- `jconsole` æ¥æŸ¥çœ‹æŸä¸ª Java è¿›ç¨‹ä¸­çº¿ç¨‹çš„è¿è¡Œæƒ…å†µï¼ˆå›¾å½¢ç•Œé¢ï¼‰


**Jconsole ä½¿ç”¨**

jconsole è¿œç¨‹ç›‘æ§éœ€è¦å…ˆè¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š 

éœ€è¦ä»¥å¦‚ä¸‹æ–¹å¼è¿è¡Œä½ çš„ java ç±»(åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„å‘½ä»¤)
```
java -Djava.rmi.server.hostname=ipåœ°å€ -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=è¿æ¥ç«¯å£ -Dcom.sun.management.jmxremote.ssl=æ˜¯å¦å®‰å…¨è¿æ¥ -Dcom.sun.management.jmxremote.authenticate=æ˜¯å¦è®¤è¯ javaç±»
```

åœ¨windowsç¯å¢ƒä¸‹ï¼Œcmdä¸­è¾“å…¥`jconsole`ï¼Œè¿æ¥è¿œç¨‹çš„æœåŠ¡å™¨å³å¯ï¼Œä¾‹å¦‚`192.168.1.100:1099`ï¼›è¦æœ‰ipåŠ ç«¯å£å·è¿›è¡Œè¿æ¥ã€‚

## çº¿ç¨‹è¿è¡Œçš„åŸç†
[åŸç†è§†é¢‘](https://www.bilibili.com/video/BV16J411h7Rd?spm_id_from=333.788.videopod.episodes&vd_source=da7c7c4a886275716b7ca33f532f1905&p=21)

### æ ˆå’Œæ ˆå¸§

Java Virtual Machine Stacksï¼ˆJava è™šæ‹Ÿæœºæ ˆï¼‰ 

æˆ‘ä»¬éƒ½çŸ¥é“ **JVM ä¸­ç”±å †ã€æ ˆã€æ–¹æ³•åŒºæ‰€ç»„æˆ**ï¼Œå…¶ä¸­æ ˆå†…å­˜æ˜¯ç»™è°ç”¨çš„å‘¢ï¼Ÿå…¶å®å°±æ˜¯çº¿ç¨‹ (å¯¹è±¡éƒ½æ˜¯åœ¨å †ä¸­åˆ›å»ºçš„)ï¼Œæ¯ä¸ªçº¿ç¨‹å¯åŠ¨åï¼Œè™šæ‹Ÿæœºå°±ä¼šä¸ºå…¶åˆ†é…ä¸€å—æ ˆå†…å­˜ã€‚ 
- æ¯ä¸ªæ ˆç”±å¤šä¸ªæ ˆå¸§ï¼ˆFrameï¼‰ç»„æˆï¼Œå¯¹åº”ç€æ¯æ¬¡æ–¹æ³•è°ƒç”¨æ—¶æ‰€å ç”¨çš„å†…å­˜ 
- æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§ï¼Œå¯¹åº”ç€å½“å‰æ­£åœ¨æ‰§è¡Œçš„é‚£ä¸ªæ–¹æ³• 

åœ¨ideaä¸­debugçš„æ—¶å€™ï¼Œå°±èƒ½çœ‹åˆ°æ ˆå¸§ä¿¡æ¯ï¼›æ¯æ‰§è¡Œä¸€ä¸ªæ–¹æ³•å°±ä¼šç”Ÿæˆä¸€ä¸ªæ ˆå¸§ï¼Œä¸€ä¸ªçº¿ç¨‹çš„æ ˆä¸­å¯ä»¥æœ‰å¤šä¸ªæ ˆå¸§ï¼ˆå¯¹åº”æ–¹æ³•è°ƒç”¨é“¾ï¼Œå¦‚ main â†’ methodA â†’ methodBï¼‰ã€‚

**æ ˆå¸§æ˜¯å…ˆè¿›åå‡º**ï¼›

**æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆ**ï¼›è¿™ä¸ªæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œä¸å…¶ä»–çº¿ç¨‹éš”ç¦»ã€‚
### çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢

Thread Context Switchï¼ˆçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰


ä»¥ä¸‹ä¸€äº›åŸå› ä¼šå¯¼è‡´ CPU ä¸å†æ‰§è¡Œå½“å‰çš„çº¿ç¨‹ï¼Œè½¬è€Œæ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹çš„ä»£ç ï¼š
1. çº¿ç¨‹çš„ cpu æ—¶é—´ç‰‡ç”¨å®Œ
2. åƒåœ¾å›æ”¶ï¼ˆä¼šæš‚åœå½“å‰æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œè®©åƒåœ¾å›æ”¶çš„çº¿ç¨‹æ¥è¿è¡Œï¼‰
3. æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹éœ€è¦è¿è¡Œ
4. çº¿ç¨‹è‡ªå‘è°ƒç”¨äº† sleep()ã€yield()ã€wait()ã€join()ã€park()ã€synchronizedã€lock() ç­‰æ–¹æ³•

å½“ä¸Šä¸‹æ–‡åˆ‡æ¢å‘ç”Ÿæ—¶ï¼Œéœ€è¦ç”±æ“ä½œç³»ç»Ÿä¿å­˜å½“å‰çº¿ç¨‹çš„çŠ¶æ€ï¼Œå¹¶æ¢å¤å¦ä¸€ä¸ªçº¿ç¨‹çš„çŠ¶æ€ï¼ŒJava ä¸­å¯¹åº”çš„æ¦‚å¿µå°±æ˜¯**ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰**ï¼Œå®ƒçš„ä½œç”¨æ˜¯è®°ä½ä¸‹ä¸€æ¡ jvm æŒ‡ä»¤çš„æ‰§è¡Œåœ°å€ï¼Œå®ƒæ˜¯çº¿ç¨‹ç§æœ‰çš„ 
- çŠ¶æ€åŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆä¸­æ¯ä¸ªæ ˆå¸§çš„ä¿¡æ¯ï¼Œå¦‚å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆã€è¿”å›åœ°å€ç­‰ 
- é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ä¼šå½±å“æ€§èƒ½


### ç›¸å…³é¢è¯•é¢˜ğŸ¤ğŸ»


**ä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ**

çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šæœ‰è‡ªå·±çš„è¿è¡Œæ¡ä»¶å’ŒçŠ¶æ€ï¼ˆä¹Ÿç§°ä¸Šä¸‹æ–‡ï¼‰ï¼Œæ¯”å¦‚ç¨‹åºè®¡æ•°å™¨ï¼Œæ ˆä¿¡æ¯ç­‰ã€‚å½“å‡ºç°å¦‚ä¸‹æƒ…å†µçš„æ—¶å€™ï¼Œçº¿ç¨‹ä¼šä»å ç”¨ CPU çŠ¶æ€ä¸­é€€å‡ºã€‚
- ä¸»åŠ¨è®©å‡º CPUï¼Œæ¯”å¦‚è°ƒç”¨äº†sleep(), wait() ç­‰ã€‚
- æ—¶é—´ç‰‡ç”¨å®Œï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿè¦é˜²æ­¢ä¸€ä¸ªçº¿ç¨‹æˆ–è€…è¿›ç¨‹é•¿æ—¶é—´å ç”¨ CPU å¯¼è‡´å…¶ä»–çº¿ç¨‹æˆ–è€…è¿›ç¨‹é¥¿æ­»ã€‚
- è°ƒç”¨äº†é˜»å¡ç±»å‹çš„ç³»ç»Ÿä¸­æ–­ï¼Œæ¯”å¦‚è¯·æ±‚ IOï¼Œçº¿ç¨‹è¢«é˜»å¡ã€‚
- è¢«ç»ˆæ­¢æˆ–ç»“æŸè¿è¡Œ

è¿™å…¶ä¸­å‰ä¸‰ç§éƒ½ä¼šå‘ç”Ÿçº¿ç¨‹åˆ‡æ¢ï¼Œçº¿ç¨‹åˆ‡æ¢æ„å‘³ç€éœ€è¦ä¿å­˜å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œç•™å¾…çº¿ç¨‹ä¸‹æ¬¡å ç”¨ CPU çš„æ—¶å€™æ¢å¤ç°åœºã€‚å¹¶åŠ è½½ä¸‹ä¸€ä¸ªå°†è¦å ç”¨ CPU çš„çº¿ç¨‹ä¸Šä¸‹æ–‡ã€‚è¿™å°±æ˜¯æ‰€è°“çš„ **ä¸Šä¸‹æ–‡åˆ‡æ¢**ã€‚

ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯ç°ä»£æ“ä½œç³»ç»Ÿçš„åŸºæœ¬åŠŸèƒ½ï¼Œå› å…¶æ¯æ¬¡éœ€è¦ä¿å­˜ä¿¡æ¯æ¢å¤ä¿¡æ¯ï¼Œè¿™å°†ä¼šå ç”¨ CPUï¼Œå†…å­˜ç­‰ç³»ç»Ÿèµ„æºè¿›è¡Œå¤„ç†ï¼Œä¹Ÿå°±æ„å‘³ç€æ•ˆç‡ä¼šæœ‰ä¸€å®šæŸè€—ï¼Œå¦‚æœé¢‘ç¹åˆ‡æ¢å°±ä¼šé€ æˆæ•´ä½“æ•ˆç‡ä½ä¸‹ã€‚


:::tip
**â€œæ—¶é—´ç‰‡ç”¨å®Œâ€**

â€œæ—¶é—´ç‰‡â€ï¼ˆTime Sliceï¼‰æ˜¯æ“ä½œç³»ç»Ÿåˆ†é…ç»™æ¯ä¸ªçº¿ç¨‹/è¿›ç¨‹çš„ä¸€å°æ®µ CPU ä½¿ç”¨æ—¶é—´ï¼Œæ¯”å¦‚ 10 æ¯«ç§’ã€‚
å½“ä¸€ä¸ªçº¿ç¨‹å¼€å§‹è¿è¡Œï¼Œå®ƒåªèƒ½ä½¿ç”¨ CPU ä¸€æ®µæ—¶é—´ï¼ˆå³è¿™ä¸ªâ€œæ—¶é—´ç‰‡â€ï¼‰ã€‚
ä¸€æ—¦è¿™ä¸ªæ—¶é—´åˆ°äº†ï¼Œæ—¶é—´ç‰‡ç”¨å®Œï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šä¸­æ–­å®ƒï¼Œè¿›è¡Œè°ƒåº¦ã€‚è¿™ç§æœºåˆ¶å«åš **æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦**ï¼ˆRound-Robin Schedulingï¼‰, æ—¶é—´ç‰‡çš„é•¿åº¦ç”±æ“ä½œç³»ç»Ÿå†³å®šï¼Œé€šå¸¸æ˜¯å‡ æ¯«ç§’åˆ°å‡ åæ¯«ç§’

**â€œå¯¼è‡´å…¶ä»–çº¿ç¨‹æˆ–è¿›ç¨‹é¥¿æ­»â€**

â€œé¥¿æ­»â€ï¼ˆStarvationï¼‰æ˜¯ä¸€ä¸ªæœ¯è¯­ï¼Œæ„æ€æ˜¯ï¼šæŸäº›çº¿ç¨‹é•¿æœŸå¾—ä¸åˆ° CPU æ—¶é—´ï¼Œæ— æ³•æ‰§è¡Œã€‚

æ¯”å¦‚ä½ æœ‰ 10
ä¸ªçº¿ç¨‹ï¼Œä½†æœ‰ä¸€ä¸ªâ€œéœ¸é“â€çº¿ç¨‹ä¸€ç›´è¿è¡Œï¼Œå…¶ä»– 9 ä¸ªä¸€ç›´ç­‰ï¼Œæ°¸è¿œç­‰ä¸åˆ°æœºä¼š â€”â€” å®ƒä»¬å°±â€œé¥¿æ­»äº†â€ã€‚

:::



## çº¿ç¨‹å¸¸è§æ–¹æ³•

| æ–¹æ³•å | æ˜¯å¦æ˜¯é™æ€æ–¹æ³• | åŠŸèƒ½è¯´æ˜ | æ³¨æ„
| --- | --- | --- | ---
| start() |  | å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œåœ¨æ–°çš„çº¿ç¨‹è¿è¡Œ run æ–¹æ³•ä¸­çš„ä»£ç  | start æ–¹æ³•åªæ˜¯è®©çº¿ç¨‹è¿›å…¥å°±ç»ªï¼Œé‡Œé¢ä»£ç ä¸ä¸€å®šç«‹åˆ»è¿è¡Œï¼ˆCPU çš„æ—¶é—´ç‰‡è¿˜æ²¡åˆ†ç»™å®ƒï¼‰ã€‚æ¯ä¸ªçº¿ç¨‹å¯¹è±¡çš„ start æ–¹æ³•åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œå¦‚æœè°ƒç”¨äº†å¤šæ¬¡ä¼šå‡ºç° IllegalThreadStateException
| run() |  | æ–°çº¿ç¨‹å¯åŠ¨åä¼šè°ƒç”¨çš„æ–¹æ³• | å¦‚æœåœ¨æ„é€  Thread å¯¹è±¡æ—¶ä¼ é€’äº† Runnable å‚æ•°ï¼Œåˆ™çº¿ç¨‹å¯åŠ¨åä¼šè°ƒç”¨ Runnable ä¸­çš„ run æ–¹æ³•ï¼Œå¦åˆ™é»˜è®¤ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ä½†å¯ä»¥åˆ›å»º Thread çš„å­ç±»å¯¹è±¡ï¼Œæ¥è¦†ç›–é»˜è®¤è¡Œä¸º
| join() |  | ç­‰å¾…çº¿ç¨‹è¿è¡Œç»“æŸ | 
| join(long n) |  | ç­‰å¾…çº¿ç¨‹è¿è¡Œç»“æŸ,æœ€å¤šç­‰å¾… n æ¯«ç§’ | 
| getId() |  | è·å–çº¿ç¨‹é•¿æ•´å‹çš„ id | id å”¯ä¸€
| getName() |  | è·å–çº¿ç¨‹å | 
| setName(String) |  | ä¿®æ”¹çº¿ç¨‹å | 
| getPriority() |  | è·å–çº¿ç¨‹ä¼˜å…ˆçº§ | 
| setPriority(int) |  | ä¿®æ”¹çº¿ç¨‹ä¼˜å…ˆçº§ | java ä¸­è§„å®šçº¿ç¨‹ä¼˜å…ˆçº§æ˜¯ 1~10 çš„æ•´æ•°ï¼Œè¾ƒå¤§çš„ä¼˜å…ˆçº§èƒ½æé«˜è¯¥çº¿ç¨‹è¢« CPU è°ƒåº¦çš„æœºç‡
| getState() |  | è·å–çº¿ç¨‹çŠ¶æ€ | Java ä¸­çº¿ç¨‹çŠ¶æ€æ˜¯ç”¨ 6 ä¸ª enum è¡¨ç¤ºï¼Œåˆ†åˆ«ä¸ºï¼šNEW, RUNNABLE, BLOCKED, WAITING, TIMED_WAITING, TERMINATED
| isInterrupted() |  | åˆ¤æ–­æ˜¯å¦è¢«æ‰“æ–­ï¼Œ | ä¸ä¼šæ¸…é™¤ æ‰“æ–­æ ‡è®°
| isAlive() |  | çº¿ç¨‹æ˜¯å¦å­˜æ´»ï¼ˆè¿˜æ²¡æœ‰è¿è¡Œå®Œæ¯•ï¼‰ | 
| interrupt() |  | æ‰“æ–­çº¿ç¨‹ | å¦‚æœè¢«æ‰“æ–­çº¿ç¨‹æ­£åœ¨ sleepï¼Œwaitï¼Œjoin ä¼šå¯¼è‡´è¢«æ‰“æ–­çš„çº¿ç¨‹æŠ›å‡º InterruptedExceptionï¼Œå¹¶æ¸…é™¤ æ‰“æ–­æ ‡è®°ï¼›å¦‚æœæ‰“æ–­çš„æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Œåˆ™ä¼šè®¾ç½® æ‰“æ–­æ ‡è®°ï¼›park çš„çº¿ç¨‹è¢«æ‰“æ–­ï¼Œä¹Ÿä¼šè®¾ç½® æ‰“æ–­æ ‡è®°
| interrupted() | static | åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦è¢«æ‰“æ–­ | ä¼šæ¸…é™¤ æ‰“æ–­æ ‡è®°
| currentThread() | static | è·å–å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ | 
| sleep(long n) | static | è®©å½“å‰æ‰§è¡Œçš„çº¿ç¨‹ä¼‘çœ næ¯«ç§’ï¼Œä¼‘çœ æ—¶è®©å‡º cpu çš„æ—¶é—´ç‰‡ç»™å…¶å®ƒçº¿ç¨‹ |                  |
| yield()     | static | æç¤ºçº¿ç¨‹è°ƒåº¦å™¨è®©å‡ºå½“å‰çº¿ç¨‹å¯¹ CPU çš„ä½¿ç”¨ | ä¸»è¦æ˜¯ä¸ºäº†æµ‹è¯•å’Œè°ƒè¯• |


è¿˜æœ‰ä¸€äº›ä¸æ¨èä½¿ç”¨çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å·²è¿‡æ—¶ï¼Œå®¹æ˜“ç ´ååŒæ­¥ä»£ç å—ï¼Œé€ æˆçº¿ç¨‹æ­»é”
| æ–¹æ³•å|æ˜¯å¦æ˜¯é™æ€æ–¹æ³•|åŠŸèƒ½è¯´æ˜
|:----:|:----:|:----:|
|stop()|N|åœæ­¢çº¿ç¨‹è¿è¡Œ|
|suspend()|N|æŒ‚èµ·ï¼ˆæš‚åœï¼‰çº¿ç¨‹è¿è¡Œ|
|resume()|N|æ¢å¤çº¿ç¨‹è¿è¡Œ|

### startã€run
ç»“è®ºï¼š
1. ç›´æ¥è°ƒç”¨run()æ–¹æ³•ï¼Œç›¸å½“äº**åŒæ­¥**ã€‚æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œrun()æ–¹æ³•ï¼Œå¹¶æ²¡æœ‰å¯åŠ¨æ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œï¼
2. é€šè¿‡start()æ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹ï¼Œç›¸å½“äº**å¼‚æ­¥**ã€‚é€šè¿‡æ–°çš„çº¿ç¨‹æ¥é—´æ¥æ‰§è¡Œrun()ä¸­çš„ä»£ç ï¼

startç”¨æ¥å¯åŠ¨çº¿ç¨‹ï¼Œrunæ˜¯çº¿ç¨‹å¯åŠ¨åï¼Œè¦æ‰§è¡Œçš„æ–¹æ³•ã€‚

startæ–¹æ³•åªæ˜¯è®©çº¿ç¨‹è¿›å…¥å°±ç»ªï¼Œé‡Œé¢ä»£ç ä¸ä¸€å®šç«‹åˆ»è¿è¡Œï¼ˆCPU çš„æ—¶é—´ç‰‡è¿˜æ²¡åˆ†ç»™å®ƒï¼‰ã€‚æ¯ä¸ªçº¿ç¨‹å¯¹è±¡çš„ start æ–¹æ³•åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œå¦‚æœè°ƒç”¨äº†å¤šæ¬¡ä¼šå‡ºç° IllegalThreadStateExceptionã€‚


ç›´æ¥è°ƒç”¨runçš„è¯ä¸ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„çº¿ç¨‹ è€Œæ˜¯åœ¨å½“å‰çš„çº¿ç¨‹é‡Œé¢æ‰§è¡Œã€‚ç›´æ¥è°ƒç”¨runæ–¹æ³•ï¼Œç›¸å½“äºæ˜¯åŒæ­¥çš„ï¼Œä¸æ˜¯å¼‚æ­¥äº†

ä¸¤è€…åŒºåˆ«ä»£ç æ¼”ç¤ºå¦‚ä¸‹ï¼š
```java
@Slf4j(topic = "c.Test4")
public class ThreadRunTest {

    public static void main(String[] args) {
        Thread t1 = new Thread(new Runnable() {
            @Override
            public void run() {
                log.debug("running...");
                try {
                    Thread.sleep(1000);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }, "t1");

        t1.run();
        log.debug("do other things...");
    }
}
```
```java
22:36:54.587 c.Test4 [main] - running...
22:36:56.596 c.Test4 [main] - do other things...
```
æˆ‘ä»¬å‘ç°çº¿ç¨‹ä¸€ç›´åœ¨ã€mainã€‘çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œrun()æ–¹æ³•è°ƒç”¨è¿˜æ˜¯åŒæ­¥çš„ã€‚

```java
@Slf4j(topic = "c.Test4")
public class ThreadRunTest {

    public static void main(String[] args) {
        Thread t1 = new Thread(new Runnable() {
            @Override
            public void run() {
                log.debug("running...");
                try {
                    Thread.sleep(1000);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }, "t1");

        // å°† run() æ”¹æˆ start() 	
        t1.start();
        log.debug("do other things...");
    }
}
```
```java
22:47:58.687 c.Test4 [main] - do other things...
22:47:58.687 c.Test4 [t1] - running...
```
æˆ‘ä»¬å‘ç°run()æ–¹æ³•ä¸­çš„ä»£ç åœ¨t1çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæ˜¯å¼‚æ­¥è°ƒç”¨çš„ã€‚


**çº¿ç¨‹æ‰§è¡Œå‰åçŠ¶æ€ä¿¡æ¯å˜åŒ–**

```java
@Slf4j(topic = "c.Test5")
public class ThreadStateTest {
    public static void main(String[] args) {
        Thread t1 = new Thread(new Runnable() {
            @Override
            public void run() {
                log.debug("running...");
            }
        }, "t1");

        // æŸ¥çœ‹çº¿ç¨‹æ‰§è¡Œå‰åçš„çŠ¶æ€ä¿¡æ¯
        System.out.println(t1.getState());
        t1.start();
//        t1.start();   ä¸èƒ½è¢«å¤šæ¬¡è°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™
        System.out.println(t1.getState());
    }
}
```
```java
NEW  
RUNNABLE
22:55:49.182 c.Test5 [t1] - running...
```

:::info
- NEWï¼šåˆå§‹çŠ¶æ€ï¼Œçº¿ç¨‹è¢«åˆ›å»ºå‡ºæ¥ä½†æ²¡æœ‰è¢«è°ƒç”¨start() ã€‚
- RUNNABLEï¼šè¿è¡ŒçŠ¶æ€ï¼Œçº¿ç¨‹è¢«è°ƒç”¨äº†start()ç­‰å¾…è¿è¡Œçš„çŠ¶æ€ã€‚
:::
ä¸è°ƒstartå°±æ˜¯åˆå§‹çŠ¶æ€ï¼Œè°ƒç”¨äº†startå°±æ˜¯runnable

### sleep()
**sleep()æ–¹æ³•**
1. è°ƒç”¨`sleep()`ä¼šè®©å½“å‰çº¿ç¨‹ä» `Running` çŠ¶æ€è¿›å…¥ `Timed Waiting` çŠ¶æ€ï¼ˆè¿è¡Œ -> é˜»å¡ï¼‰ 
2. å…¶å®ƒçº¿ç¨‹å¯ä»¥ç”¨interruptæ–¹æ³•æ‰“æ–­æ­£åœ¨ç¡çœ çš„çº¿ç¨‹ï¼Œè¿™æ—¶`sleep()`ä¼šæŠ›å‡º`InterruptedException`
3. ç¡çœ ç»“æŸåçš„çº¿ç¨‹æœªå¿…ä¼šç«‹åˆ»å¾—åˆ°æ‰§è¡Œ (cpuæœ‰å¯èƒ½æ­£åœ¨æ‰§è¡Œå…¶ä»–çº¿ç¨‹çš„ä»£ç ï¼Œç­‰åˆ°ä»»åŠ¡è°ƒåº¦å™¨æŠŠæ–°çš„æ—¶é—´ç‰‡åˆ†ç»™è¯¥çº¿ç¨‹ï¼Œæ‰ä¼šç»§ç»­è¿è¡Œ)
4. å»ºè®®ç”¨TimeUnitçš„sleepä»£æ›¿Threadçš„sleepæ¥è·å¾—æ›´å¥½çš„å¯è¯»æ€§ 
5. sleep() ä¼šè®©å‡º CPU èµ„æºï¼Œè¿›å…¥â€œé˜»å¡â€çŠ¶æ€ã€‚ä½†ä¸é‡Šæ”¾é”; 
```java
@Slf4j
public class TestSleep {
    public static void main(String[] args) throws InterruptedException {
        Thread t1 = new Thread(() -> {
            try {
                TimeUnit.SECONDS.sleep(2);
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
        }, "t1");

        t1.start();
        log.info("t1:{}", t1.getState());
        TimeUnit.MILLISECONDS.sleep(500);
        log.info("t1:{}", t1.getState());
    }
}
```
```
20:56:18.937 [main] INFO com.thread.concurrent1.TestSleep -- t1:RUNNABLE
20:56:19.448 [main] INFO com.thread.concurrent1.TestSleep -- t1:TIMED_WAITING
```

*interrupt() æ–¹æ³•æ¼”ç¤º*
```java
@Slf4j
public class TestSleep {
    public static void main(String[] args) throws InterruptedException {
        Thread t1 = new Thread(() -> {
            try {
                TimeUnit.SECONDS.sleep(2);
            } catch (InterruptedException e) {
                log.info("wake up");
                throw new RuntimeException(e);
            }
        }, "t1");

        t1.start();
        TimeUnit.SECONDS.sleep(1);
        log.info("interrupted...");
        t1.interrupt();
    }
}
```
```
21:01:29.040 [main] INFO com.thread.concurrent1.TestSleep -- interrupted...
21:01:29.043 [t1] INFO com.thread.concurrent1.TestSleep -- wake up
Exception in thread "t1" java.lang.RuntimeException: java.lang.InterruptedException: sleep interrupted
	at com.thread.concurrent1.TestSleep.lambda$main$0(TestSleep.java:23)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.lang.InterruptedException: sleep interrupted
	at java.base/java.lang.Thread.sleep0(Native Method)
	at java.base/java.lang.Thread.sleep(Thread.java:558)
	at java.base/java.util.concurrent.TimeUnit.sleep(TimeUnit.java:446)
	at com.thread.concurrent1.TestSleep.lambda$main$0(TestSleep.java:20)
	... 1 more
```



### yield()
**yield()æ–¹æ³•**
1. è°ƒç”¨yield()ä¼šè®©å½“å‰çº¿ç¨‹ä» Running çŠ¶æ€è¿›å…¥ Runnable å°±ç»ªçŠ¶æ€ï¼Œç„¶åè°ƒåº¦æ‰§è¡Œå…¶å®ƒçº¿ç¨‹
2. å…·ä½“çš„å®ç°ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦å™¨ ï¼ˆæœ‰å¯èƒ½æ²¡æœ‰å…¶ä»–çº¿ç¨‹éœ€è¦ä½¿ç”¨cpuæ—¶é—´ç‰‡ï¼Œé‚£ä¹ˆç³»ç»ŸåˆæŠŠæ‰§è¡Œæƒäº¤ç»™ä½ äº†ï¼‰
3. å’Œsleep()ä¸€æ ·ï¼Œä¸ä¼šé‡Šæ”¾ä»»ä½•å·²æŒæœ‰çš„é”ï¼ˆå¦‚ synchronizedï¼‰


å°±ç»ªçŠ¶æ€(yield)æœ‰æœºä¼šè·å¾—æ—¶é—´ç‰‡ï¼Œé˜»å¡çŠ¶æ€(sleep)ä¸èƒ½è·å¾—æ—¶é—´ç‰‡


### çº¿ç¨‹ä¼˜å…ˆçº§

`setPrority(int newPrority)`ï¼šè®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§
- çº¿ç¨‹ä¼˜å…ˆçº§ä¼šæç¤ºï¼ˆhintï¼‰è°ƒåº¦å™¨ä¼˜å…ˆè°ƒåº¦è¯¥çº¿ç¨‹ï¼Œä½†å®ƒä»…ä»…æ˜¯ä¸€ä¸ªæç¤ºï¼Œè°ƒåº¦å™¨å¯ä»¥å¿½ç•¥å®ƒ
- å¦‚æœ cpu æ¯”è¾ƒå¿™ï¼Œé‚£ä¹ˆä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹ä¼šè·å¾—æ›´å¤šçš„æ—¶é—´ç‰‡ï¼Œä½† cpu é—²æ—¶ï¼Œä¼˜å…ˆçº§å‡ ä¹æ²¡ä½œç”¨


```java
@Slf4j
public class TestPrority {
    public static void main(String[] args) {
        Runnable task1 = () -> {
            int count = 0;
            for (; ; ) {
                System.out.println("---->1 " + count++);
            }
        };
        Runnable task2 = () -> {
            int count = 0;
            for (; ; ) {
                // Thread.yield();
                System.out.println("              ---->2 " + count++);
            }
        };
        Thread t1 = new Thread(task1, "t1");
        Thread t2 = new Thread(task2, "t2");
        // t1.setPriority(Thread.MIN_PRIORITY);
        // t2.setPriority(Thread.MAX_PRIORITY);
        t1.start();
        t2.start();
    }
}
```
```
---->1 173105
---->1 173106
---->1 173107
---->1 173108
---->1 173109
---->1 173110
              ---->2 171147
              ---->2 171148
              ---->2 171149
              ---->2 171150
              ---->2 171151
```
æˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¾“å‡ºçš„æ•°å­—éƒ½æ˜¯æ¯”è¾ƒç›¸è¿‘çš„

```java
@Slf4j
public class TestPrority {
    public static void main(String[] args) {
        Runnable task1 = () -> {
            int count = 0;
            for (; ; ) {
                System.out.println("---->1 " + count++);
            }
        };
        Runnable task2 = () -> {
            int count = 0;
            for (; ; ) {
                Thread.yield();
                System.out.println("              ---->2 " + count++);
            }
        };
        Thread t1 = new Thread(task1, "t1");
        Thread t2 = new Thread(task2, "t2");
        // t1.setPriority(Thread.MIN_PRIORITY);
        // t2.setPriority(Thread.MAX_PRIORITY);
        t1.start();
        t2.start();
    }
}
```
```
---->1 167177
---->1 167178
---->1 167179
---->1 167180
---->1 167181
---->1 167182
---->1 167183
---->1 167184
---->1 167185
---->1 167186
              ---->2 79648
              ---->2 79649
              ---->2 79650
              ---->2 79651
              ---->2 79652
              ---->2 79653
              ---->2 79654
              ---->2 79655
```
å› ä¸ºæœ‰yieldçš„å­˜åœ¨ï¼Œç›¸å·®å¾ˆå¤§

---

```java
@Slf4j
public class TestPrority {
    public static void main(String[] args) {
        Runnable task1 = () -> {
            int count = 0;
            for (; ; ) {
                System.out.println("---->1 " + count++);
            }
        };
        Runnable task2 = () -> {
            int count = 0;
            for (; ; ) {
//                Thread.yield();
                System.out.println("              ---->2 " + count++);
            }
        };
        Thread t1 = new Thread(task1, "t1");
        Thread t2 = new Thread(task2, "t2");
         t1.setPriority(Thread.MIN_PRIORITY);
         t2.setPriority(Thread.MAX_PRIORITY);
        t1.start();
        t2.start();
    }
}
```
```
---->1 117769
---->1 117770
---->1 117771
---->1 117772
---->1 117773
---->1 117774
---->1 117775
---->1 117776
---->1 117777
---->1 117778
---->1 117779
---->1 117780
              ---->2 125324
              ---->2 125325
              ---->2 125326
              ---->2 125327
              ---->2 125328
              ---->2 125329
              ---->2 125330
              ---->2 125331
              ---->2 125332
              ---->2 125333
              ---->2 125334
              ---->2 125335
              ---->2 125336
              ---->2 125337
              ---->2 125338
```
ä¼˜å…ˆçº§çš„å­˜åœ¨ï¼Œä¹Ÿä¼šç›¸å·®æ¯”è¾ƒå¤§

>æ€»ç»“ï¼š
>
>ä¸ç®¡æ˜¯ yield() è¿˜æ˜¯ä¼˜å…ˆçº§ï¼Œä»–ä»¬éƒ½ä¸èƒ½çœŸæ­£çš„å»æ§åˆ¶çº¿ç¨‹çš„è°ƒåº¦ï¼Œæœ€ç»ˆè¿˜æ˜¯ç”±æ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦å™¨æ¥å†³å®šå…·ä½“å“ªä¸ªçº¿ç¨‹åˆ†åˆ°æ›´å¤šçš„æ—¶é—´ç‰‡ã€‚


#### åº”ç”¨ â€”â€” è§£é™¤å¯¹ CPU çš„ä½¿ç”¨

sleep() å®ç°

åœ¨æ²¡æœ‰åˆ©ç”¨ `CPU` æ¥è®¡ç®—æ—¶ï¼Œä¸è¦è®©`while(true)`ç©ºè½¬æµªè´¹ `CPU`ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨`yield()`æˆ– `sleep()` æ–¹æ³•æ¥è®©å‡º `CPU` çš„ä½¿ç”¨æƒç»™å…¶ä»–çš„ç¨‹åºï¼
```java
while(true) {
    try {
        Thread.sleep(50);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}
```
Linux ä¸‹å¯é€šè¿‡ top å‘½ä»¤æ¥æŸ¥çœ‹å¯¹ CPU çš„å ç”¨ç‡ã€‚

1. åœ¨å•æ ¸ CPU ä¸‹ï¼Œæ­¤ä»£ç å¯¹ CPU çš„å ç”¨ç‡é«˜è¾¾ 90%ã€‚å…¶ä»–ç¨‹åºå‡ ä¹ç”¨ä¸ä¸Šæ­¤ CPUã€‚
![](https://zzyang.oss-cn-hangzhou.aliyuncs.com/img/Snipaste_2025-08-13_21-46-57.png)

2. åœ¨å•æ ¸ CPU ä¸‹ï¼ŒåŠ ä¸Šsleep()æ–¹æ³•ç¡çœ åï¼ŒJava ç¨‹åºå¯¹ CPU çš„å ç”¨å¤§å¤§é™ä½ï¼Œé¿å…ç©ºè½¬å ç”¨ CPUã€‚
![](https://zzyang.oss-cn-hangzhou.aliyuncs.com/img/Snipaste_2025-08-13_21-48-08.png)



- å¯ä»¥ç”¨wait()æˆ–æ¡ä»¶å˜é‡è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœ
- ä¸åŒçš„æ˜¯ï¼Œåä¸¤ç§éƒ½éœ€è¦åŠ é”ï¼Œå¹¶ä¸”éœ€è¦ç›¸åº”çš„å”¤é†’æ“ä½œï¼Œä¸€èˆ¬é€‚ç”¨äºè¦è¿›è¡ŒåŒæ­¥çš„åœºæ™¯
- sleep()é€‚ç”¨äºæ— éœ€é”åŒæ­¥çš„åœºæ™¯

### join()


#### ä¸ºä»€ä¹ˆéœ€è¦join()
ä¸‹é¢çš„ä»£ç ï¼Œæ‰“å°å‡ºæ¥çš„rå€¼æ˜¯å¤šå°‘ï¼Ÿ
```java
static int r = 0;
public static void main(String[] args) throws InterruptedException {
    test1();
}

private static void test1() throws InterruptedException {
    log.debug("å¼€å§‹");
    Thread t1 = new Thread(() -> {
        log.debug("å¼€å§‹");
        sleep(1);
        log.debug("ç»“æŸ");
        r = 10;
    });
    t1.start();
    log.debug("ç»“æœä¸º:{}", r);
    log.debug("ç»“æŸ");
}
```
è¾“å‡ºï¼š
```
23:07:21.660 c.Test10 [main] - å¼€å§‹
23:07:21.663 c.Test10 [Thread-0] - å¼€å§‹
23:07:21.663 c.Test10 [main] - ç»“æœä¸º:0
23:07:21.664 c.Test10 [main] - ç»“æŸ
23:07:22.670 c.Test10 [Thread-0] - ç»“æŸ
```
åˆ†æï¼š
- å› ä¸ºä¸»çº¿ç¨‹å’Œçº¿ç¨‹ t1 æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œt1 çº¿ç¨‹éœ€è¦ 1 ç§’ä¹‹åæ‰èƒ½ç®—å‡º r=10 
- è€Œä¸»çº¿ç¨‹ä¸€å¼€å§‹å°±è¦æ‰“å° r çš„ç»“æœï¼Œæ‰€ä»¥å°±ä¼šæ‰“å°å‡º r=0

è§£å†³æ–¹æ³•ï¼š
- ç”¨join()ï¼ŒåŠ åœ¨ t1.start() ä¹‹åå³å¯
```java
@Slf4j(topic = "c.Test10")
public class Test10 {
    static int r = 0;
    public static void main(String[] args) throws InterruptedException {
        test1();
    }

    private static void test1() throws InterruptedException {
        log.debug("å¼€å§‹");
        Thread t1 = new Thread(() -> {
            log.debug("å¼€å§‹");
            sleep(1);
            log.debug("ç»“æŸ");
            r = 10;
        });
        t1.start();
        
        // å“ªä¸ªçº¿ç¨‹è°ƒç”¨å°±ç­‰å¾…å“ªä¸ªçº¿ç¨‹ç»“æŸ (t1çº¿ç¨‹è°ƒç”¨å°±ç­‰å¾…t1çº¿ç¨‹ç»“æŸ)
        // ä¸»çº¿ç¨‹ç­‰å¾… t1 çº¿ç¨‹ç»“æŸ
        t1.join();

        
        log.debug("ç»“æœä¸º:{}", r);
        log.debug("ç»“æŸ");
    }
}
```


#### åŒæ­¥åº”ç”¨

ä»¥è°ƒç”¨æ–¹è§’åº¦æ¥è®²ï¼Œå¦‚æœ
- éœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œæ‰èƒ½ç»§ç»­è¿è¡Œå°±æ˜¯åŒæ­¥ 
- ä¸éœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œå°±èƒ½ç»§ç»­è¿è¡Œå°±æ˜¯å¼‚æ­¥

![](https://zzyang.oss-cn-hangzhou.aliyuncs.com/img/Snipaste_2025-08-13_22-17-27.png)

**ç­‰å¾…å¤šä¸ªçº¿ç¨‹ç»“æœ**

é—®ï¼šä¸‹é¢ä»£ç  cost å¤§çº¦å¤šå°‘ç§’ï¼Ÿ
 ç­”ï¼š2s å·¦å³

```java
static int r1 = 0;
static int r2 = 0;
public static void main(String[] args) throws InterruptedException {
    test2();
}
private static void test2() throws InterruptedException {
    Thread t1 = new Thread(() -> {
        sleep(1);
        r1 = 10;
    });
    Thread t2 = new Thread(() -> {
        sleep(2);
        r2 = 20;
    });
    long start = System.currentTimeMillis();
    t1.start();
    t2.start();
    t1.join();
    t2.join();
    long end = System.currentTimeMillis();
    log.debug("r1: {} r2: {} cost: {}", r1, r2, end - start);
}
```
è¾“å‡ºï¼š
```
23:35:51.088 c.TestJoin [main] - r1: 10 r2: 20 cost: 2006
```
åˆ†æï¼š
- ç¬¬ä¸€ä¸ª joinï¼šç­‰å¾… t1 æ—¶, t2 å¹¶æ²¡æœ‰åœæ­¢, è€Œåœ¨è¿è¡Œ 
- ç¬¬äºŒä¸ª joinï¼š1s å, æ‰§è¡Œåˆ°æ­¤, t2 ä¹Ÿè¿è¡Œäº† 1s, å› æ­¤ä¹Ÿåªéœ€å†ç­‰å¾… 1s 

å¦‚æœé¢ å€’ä¸¤ä¸ª join å‘¢ï¼Ÿ 

æœ€ç»ˆéƒ½æ˜¯è¾“å‡ºï¼š`20:45:43.239 [main] c.TestJoin - r1: 10 r2: 20 cost: 2005`
![](https://zzyang.oss-cn-hangzhou.aliyuncs.com/img/Snipaste_2025-08-13_22-19-28.png)



#### æœ‰æ—¶æ•ˆçš„join()
1. å¦‚æœç­‰å¤Ÿæ—¶é—´ï¼Œä¼šæå‰ç»“æŸjoin()çš„ç­‰å¾…ã€‚
2. å¦‚æœæ²¡ç­‰å¤Ÿæ—¶é—´ï¼Œåˆ™ä¸»çº¿ç¨‹ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ— å½±å“ã€‚

ç­‰å¤Ÿæ—¶é—´
```java
@Slf4j
public class Test1 {
    static int r1 = 0;
    static int r2 = 0;
    public static void main(String[] args) throws InterruptedException {
        test3();
    }

    public static void test3() throws InterruptedException {
        Thread t1 = new Thread(() -> {
            try {
                sleep(2000);
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
            r1 = 10;
        });
        long start = System.currentTimeMillis();
        t1.start();
        // çº¿ç¨‹æ‰§è¡Œç»“æŸä¼šå¯¼è‡´ join ç»“æŸ
        t1.join(3000);
        long end = System.currentTimeMillis();
        log.info("r1: {} r2: {} cost: {}", r1, r2, end - start);
    }
}
```
```
22:32:19.077 [main] INFO com.thread.concurrent1.Test1 -- r1: 10 r2: 0 cost: 2013
```

æ²¡ç­‰å¤Ÿæ—¶é—´
```java
@Slf4j
public class Test1 {
    static int r1 = 0;
    static int r2 = 0;
    public static void main(String[] args) throws InterruptedException {
        test3();
    }

    public static void test3() throws InterruptedException {
        Thread t1 = new Thread(() -> {
            try {
                sleep(2000);
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
            r1 = 10;
        });
        long start = System.currentTimeMillis();
        t1.start();
        // çº¿ç¨‹æ‰§è¡Œç»“æŸä¼šå¯¼è‡´ join ç»“æŸ
        t1.join(1500);
        long end = System.currentTimeMillis();
        log.info("r1: {} r2: {} cost: {}", r1, r2, end - start);
    }
}
```
```
22:31:05.884 [main] INFO com.thread.concurrent1.Test1 -- r1: 0 r2: 0 cost: 1505
```

>ç­‰æœ‹å‹,äº”åˆ†é’Ÿä½ ä¸ä¸‹æ¥,æˆ‘å°±èµ°äº†





### interrupt

#### interruptæ‰“æ–­é˜»å¡

æ‰“æ–­ç­‰å¾…çŠ¶æ€/é˜»å¡çŠ¶æ€çš„çº¿ç¨‹, ä¼šæŠ›å‡ºå¼‚å¸¸ä¿¡æ¯è¡¨ç¤ºè¢«æ‰“æ–­ï¼Œæ­¤æ—¶ä¼šæ¸…ç©ºæ‰“æ–­çŠ¶æ€ï¼Œæ‰“æ–­çŠ¶æ€ä¸ºfalse
```java
@Slf4j
public class Test2 {
    public static void main(String[] args) throws InterruptedException {
        Thread t1 = new Thread(() -> {
            try {
                Thread.sleep(3000);
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
        }, "t1");
        t1.start();

        Thread.sleep(1000);

        t1.interrupt();
        log.info("æ‰“æ–­æ ‡è®°:{}", t1.isInterrupted());  // isInterrupted()  åˆ¤æ–­çº¿ç¨‹æ˜¯å¦è¢«æ‰“æ–­ | trueï¼šè¢«æ‰“æ–­  falseï¼šæœªè¢«æ‰“æ–­
    }
}
```
```
Exception in thread "t1" java.lang.RuntimeException: java.lang.InterruptedException: sleep interrupted
	at com.thread.concurrent1.Test2.lambda$main$0(Test2.java:20)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.lang.InterruptedException: sleep interrupted
	at java.base/java.lang.Thread.sleep0(Native Method)
	at java.base/java.lang.Thread.sleep(Thread.java:509)
	at com.thread.concurrent1.Test2.lambda$main$0(Test2.java:18)
	... 1 more
22:42:56.962 [main] INFO com.thread.concurrent1.Test2 -- æ‰“æ–­æ ‡è®°:false
```

